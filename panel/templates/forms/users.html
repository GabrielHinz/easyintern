{% extends 'main/base.html' %}
{% load bootstrap %}
{% block content %}
<form method="POST">
    {% csrf_token %}
    <div class="row">
        <div class="col-12 col-lg-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Usu√°rio</h5>
                    <div class="form-group">
                        {{form.image|bootstrap}}
                    </div>
                    <div class="form-group mt-3">
                        {{form.username|bootstrap}}
                    </div>
                    <div class="form-group mb-3 mt-3">
                        <label for="id_password">Senha</label>
                        <input type="password" class="form-control" name="password" id="id_password">
                    </div>
                    <div class="form-group mb-3 mt-3">
                        {{form.type|bootstrap}}
                    </div>
                    <div class="form-group mt-3">
                        {{form.is_active|bootstrap}}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-9">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Detalhes</h5>
                    {% if form.errors %}
                        <div class="alert alert-danger" role="alert">
                            <strong>Erro!</strong> Por favor, corrija os itens.
                        </div>
                    {% endif %}
                    <div class="form-group mt-3">
                        {{form.first_name|bootstrap}}
                    </div>
                    <div class="form-group mt-3">
                        {{form.last_name|bootstrap}}
                    </div>
                    <div data-type="company" class="form-group mt-3">
                        {{form.company_sector|bootstrap}}
                    </div>
                    <div data-type="company" class="form-group mt-3">
                        {{form.company_cnpj|bootstrap}}
                    </div>
                    <div data-type="student" class="form-group mt-3">
                        {{form.student_class|bootstrap}}
                    </div>
                    <div data-type="student" data-noreq="true" class="form-group mt-3">
                        {{form.student_internship|bootstrap}}
                    </div>
                    <div data-type="student" class="form-group mt-3">
                        {{form.ra|bootstrap}}
                    </div>
                    <hr>
                    <div class="form-group mt-3">
                        {{form.email|bootstrap}}
                    </div>
                    <div class="form-group mt-3">
                        {{form.address|bootstrap}}
                    </div>
                    <div class="form-group mt-3">
                        {{form.contact|bootstrap}}
                    </div>
                    <div data-type="student" class="form-group mt-3">
                        {{form.extra_contact|bootstrap}}
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-6">
                            <a href="{{segment_link}}" class="btn btn-secondary w-100">Cancelar</a>
                        </div>
                        <div class="col-6">
                            <button type="submit" class="btn btn-primary w-100">Submit</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

{% for field in form %}
    {% if field.errors %}
    <script>
        document.getElementById('{{ field.id_for_label }}').classList.add('is-invalid');
    </script>
    {% endif %}
{% endfor %}

{% endblock %}

{% block javascripts %}
<script>
$(document).ready(function() {
    function showHideFields() {
        var selectedType = $('#id_type').val();
        $('[data-type]').each(function() {
            if ($(this).data('type') !== selectedType) {
                $(this).hide();
                if (!$(this).data('noreq')) {
                    $(this).find('input').removeAttr('required');
                    $(this).find('select').removeAttr('required');
                }
            } else {
                $(this).show();
                if (!$(this).data('noreq')) {
                    $(this).find('select').attr('required', 'required');
                    $(this).find('input[type!="search"]').attr('required', 'required');
                }
            }
        });
    }

    showHideFields();

    $('#id_type').change(function() {
        showHideFields();
    });
});
</script>
{% endblock %}